C51 COMPILER V9.52.0.0   OLED                                                              09/08/2023 22:27:15 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN oled.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keilc51\C51\BIN\C51.EXE oled.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "reg52.h"
   2          #include "intrins.h"
   3          #include "oled.h"
   4          #include "Oledfont.h"
   5          
   6          sbit SDA = P1^3;
   7          sbit SCL = P1^2;
   8          
   9          code unsigned char peiqi[]=
  10          {
  11          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x30,0x90,0x50,0x50,0x90,0x20,0x7E,
  12          0xC1,0x1D,0x64,0x44,0x79,0x02,0xBC,0x90,0xD0,0x50,0x90,0x88,0x28,0x68,0xA8,0x28,
  13          0xA8,0x04,0xE4,0x54,0x54,0x64,0x68,0x48,0x90,0x20,0xC0,0x00,0x00,0x00,0x00,0x00,
  14          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  15          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  16          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  17          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  18          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  19          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x04,0xC9,0x32,0x84,0x65,0x13,0x08,
  20          0x05,0x3C,0x46,0x92,0x81,0x05,0xB9,0x83,0x6C,0x10,0x10,0x14,0x17,0x20,0x0C,0x03,
  21          0x07,0x08,0x13,0xA4,0xAC,0x4A,0x12,0x92,0x4F,0x20,0x0F,0x00,0x00,0x00,0x00,0x00,
  22          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  23          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  24          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  25          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  26          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  27          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0x07,0xF0,0xFE,0x04,0x72,0x88,0x09,
  28          0x0A,0x8A,0x64,0x08,0xF0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x04,
  29          0xCA,0x71,0x85,0x3C,0xC2,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  30          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  31          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  32          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  33          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  34          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  35          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x1C,0x61,0x8E,0x13,0x44,0x84,0x85,
  36          0x05,0x04,0x02,0x01,0x03,0x04,0x09,0x1A,0x12,0x14,0x14,0x14,0x12,0x8B,0x48,0x82,
  37          0xB1,0x4C,0xE3,0x1C,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  38          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,
  39          0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  40          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  41          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  42          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  43          0xF0,0x08,0x08,0x48,0x08,0xA8,0x84,0x54,0xC4,0x62,0x02,0xE3,0x1C,0x06,0x02,0x04,
  44          0x05,0x09,0x0A,0x0A,0x0A,0x02,0x0A,0x0A,0x1A,0x19,0x01,0x05,0x04,0x02,0x02,0x01,
  45          0x03,0x0C,0x71,0x82,0x22,0xC4,0x54,0x44,0xA8,0x08,0x68,0x08,0x08,0x40,0x10,0x00,
  46          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  47          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  48          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  49          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  50          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  51          0x31,0x4A,0x8A,0x06,0x12,0x83,0xA2,0x84,0x07,0xE0,0x0F,0x00,0x00,0x00,0x00,0x00,
  52          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  53          0x00,0x00,0x00,0x07,0xF8,0x03,0x3C,0xE0,0x00,0x00,0x02,0x01,0x02,0x00,0x00,0x00,
  54          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  55          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
C51 COMPILER V9.52.0.0   OLED                                                              09/08/2023 22:27:15 PAGE 2   

  56          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  57          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  58          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  59          0x00,0x00,0x00,0x01,0x01,0x00,0x0C,0x03,0x10,0x17,0x14,0x14,0x14,0xD4,0x34,0x84,
  60          0x04,0xF4,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0x14,0xF4,0x04,0xC4,0x04,
  61          0xF4,0x94,0x54,0x54,0x54,0x57,0x10,0x4F,0xA0,0x40,0x00,0x00,0x00,0x00,0x00,0x00,
  62          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  63          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,
  64          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  65          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  66          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  67          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x01,0x08,0x08,
  68          0x10,0x15,0x15,0x15,0x15,0x11,0x0C,0x00,0x00,0x00,0x00,0x00,0x07,0x08,0x00,0x08,
  69          0x0A,0x0A,0x0A,0x0A,0x08,0x00,0x01,0x90,0x90,0x00,0x80,0x80,0x90,0x90,0x80,0x20,
  70          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  71          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  72          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  73          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  74          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  75          };
  76          
  77          
  78          void iic_start() {
  79   1        SCL = 1;
  80   1        SDA = 1;
  81   1        _nop_();
  82   1        SDA = 0;
  83   1        _nop_();
  84   1      }
  85          
  86          void iic_stop() {
  87   1        SCL = 1;
  88   1        SDA = 0;
  89   1        _nop_();
  90   1        SDA = 1;
  91   1        _nop_();
  92   1      }
  93          
  94          char iic_ack() {
  95   1        char result;
  96   1        SDA = 1;//就在时钟脉冲9期间释放数据线
  97   1        _nop_();
  98   1        SCL = 1;
  99   1        result = SDA;
 100   1        _nop_();
 101   1        SCL = 0;
 102   1        _nop_();
 103   1        return result;
 104   1      }
 105          
 106          void iic_sendByte(char byte) {
 107   1        char temp = byte;
 108   1        int i;
 109   1        for(i = 0; i < 8; i ++) {
 110   2          SCL = 0;
 111   2          SDA = temp & 0x80;
 112   2          _nop_();
 113   2          SCL = 1;
 114   2          _nop_();
 115   2          // 拉低电平
 116   2          SCL = 0;
 117   2          _nop_();
C51 COMPILER V9.52.0.0   OLED                                                              09/08/2023 22:27:15 PAGE 3   

 118   2          temp <<= 1;
 119   2        }
 120   1      }
 121          
 122          void iic_write_cmd(char cmd) {
 123   1        iic_start();
 124   1        // 01111100 + R/W(0是写操作)
 125   1        iic_sendByte(0x78);
 126   1        iic_ack();
 127   1        // C0 + D/C + XXXXXX  ==> D/C = 1 表示数据  = 0 表示命令  
 128   1        iic_sendByte(0x00);
 129   1        iic_ack();
 130   1        iic_sendByte(cmd);
 131   1        iic_ack();
 132   1        iic_stop();
 133   1      }
 134          
 135          void iic_write_data(char d) {
 136   1        iic_start();
 137   1        // 01111100 + R/W(0是写操作)
 138   1        iic_sendByte(0x78);
 139   1        iic_ack();
 140   1        // C0 + D/C + XXXXXX  ==> D/C = 1 表示数据  = 0 表示命令  
 141   1        iic_sendByte(0x40);
 142   1        iic_ack();
 143   1        iic_sendByte(d);
 144   1        iic_ack();
 145   1        iic_stop();
 146   1      }
 147          
 148          
 149          void oled_init() {
 150   1        iic_write_cmd(0xAE);//--display off
 151   1        iic_write_cmd(0x00);//---set low column address
 152   1        iic_write_cmd(0x10);//---set high column address
 153   1        iic_write_cmd(0x40);//--set start line address  
 154   1        iic_write_cmd(0xB0);//--set page address
 155   1        iic_write_cmd(0x81); // contract control
 156   1        iic_write_cmd(0xFF);//--128   
 157   1        iic_write_cmd(0xA1);//set segment remap 
 158   1        iic_write_cmd(0xA6);//--normal / reverse
 159   1        iic_write_cmd(0xA8);//--set multiplex ratio(1 to 64)
 160   1        iic_write_cmd(0x3F);//--1/32 duty
 161   1        iic_write_cmd(0xC8);//Com scan direction
 162   1        iic_write_cmd(0xD3);//-set display offset
 163   1        iic_write_cmd(0x00);//
 164   1        
 165   1        iic_write_cmd(0xD5);//set osc division
 166   1        iic_write_cmd(0x80);//
 167   1        
 168   1        iic_write_cmd(0xD8);//set area color mode off
 169   1        iic_write_cmd(0x05);//
 170   1        
 171   1        iic_write_cmd(0xD9);//Set Pre-Charge Period
 172   1        iic_write_cmd(0xF1);//
 173   1        
 174   1        iic_write_cmd(0xDA);//set com pin configuartion
 175   1        iic_write_cmd(0x12);//
 176   1        
 177   1        iic_write_cmd(0xDB);//set Vcomh
 178   1        iic_write_cmd(0x30);//
 179   1        
C51 COMPILER V9.52.0.0   OLED                                                              09/08/2023 22:27:15 PAGE 4   

 180   1        iic_write_cmd(0x8D);//set charge pump enable
 181   1        iic_write_cmd(0x14);//
 182   1        
 183   1        iic_write_cmd(0xAF);//--turn on oled panel    
 184   1      }
 185          
 186          
 187          void oled_clear() {
 188   1        int i, j;
 189   1        for(i = 0; i < 8; i ++) {
 190   2          iic_write_cmd(0xB0+i);
 191   2          iic_write_cmd(0x00);
 192   2          iic_write_cmd(0x10);
 193   2          for(j = 0; j < 128; j ++) {
 194   3            iic_write_data(0);
 195   3          }
 196   2        }
 197   1      }
 198          
 199          
 200          void oled_image(unsigned char *image)
 201          {
 202   1        unsigned char i; 
 203   1        unsigned int j;
 204   1        
 205   1        for(i=0;i<8;i++){
 206   2          iic_write_cmd(0xB0 + i);
 207   2          iic_write_cmd(0x00);
 208   2          iic_write_cmd(0x10);
 209   2        
 210   2          for(j = 128 * i; j<(128 * (i+1));j++){
 211   3            iic_write_data(image[j]);
 212   3          }
 213   2        }
 214   1      }
 215          
 216          
 217          void Oled_Show_Char(char row,char col,char oledChar){ //row*2-2
 218   1        unsigned int  i;
 219   1        iic_write_cmd(0xb0+(row*2-2));                           //page 0
 220   1        iic_write_cmd(0x00+(col&0x0f));                          //low
 221   1        iic_write_cmd(0x10+(col>>4));                            //high 
 222   1        for(i=((oledChar-32)*16);i<((oledChar-32)*16+8);i++){
 223   2          iic_write_data(F8X16[i]);                            //写数据oledTable1
 224   2        }
 225   1      
 226   1        iic_write_cmd(0xb0+(row*2-1));                           //page 1
 227   1        iic_write_cmd(0x00+(col&0x0f));                          //low
 228   1        iic_write_cmd(0x10+(col>>4));                            //high
 229   1        for(i=((oledChar-32)*16+8);i<((oledChar-32)*16+8+8);i++){
 230   2          iic_write_data(F8X16[i]);                            //写数据oledTable1
 231   2        }   
 232   1      }
 233          
 234          
 235          /******************************************************************************/
 236          // 函数名称：Oled_Show_Char 
 237          // 输入参数：oledChar 
 238          // 输出参数：无 
 239          // 函数功能：OLED显示单个字符
 240          /******************************************************************************/
 241          void Oled_Show_Str(char row,char col,char *str){
C51 COMPILER V9.52.0.0   OLED                                                              09/08/2023 22:27:15 PAGE 5   

 242   1        while(*str!=0){
 243   2          Oled_Show_Char(row,col,*str);
 244   2          str++;
 245   2          col += 8; 
 246   2        }   
 247   1      }
 248          
 249          void test() {
 250   1        oled_init();
 251   1        iic_write_cmd(0x20);
 252   1        iic_write_cmd(0x02);
 253   1        
 254   1        oled_clear();
 255   1        
 256   1        oled_image(peiqi);
 257   1        
 258   1      }
 259          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    676    ----
   CONSTANT SIZE    =   2544    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
